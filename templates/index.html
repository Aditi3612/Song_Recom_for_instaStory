<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Image Song Recommender</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
  <h1>Image Song Recommender</h1>
  <form id="uploadForm" method="POST" action="/upload_photo" enctype="multipart/form-data">
      <label for="photo">Upload an Image:</label>
      <input type="file" id="photo" name="photo" accept="image/*" required>
      <br>
      <label for="manual_description">Optional: Enter additional description for the image:</label>
      <input type="text" id="manual_description" name="manual_description" placeholder="e.g. 'A sunny day at the beach'" >
      <br>
      <button type="submit">Get Song Recommendations</button>
  </form>
  <div id="results"></div>
  <script>
    document.getElementById('uploadForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const response = await fetch('/upload_photo', { method: 'POST', body: formData });
      const result = await response.json();
      const resultsDiv = document.getElementById('results');
      if (result.error) {
          resultsDiv.innerHTML = `<p>${result.error}</p>`;
      } else {
          let html = `<h2>Refined Description:</h2><p>${result.refined_description}</p>`;
          html += '<h2>Song Recommendations:</h2><ul>';
          result.recommendations.forEach(item => {
              html += `<li><strong>${item.artist} - ${item.track}</strong> (Score: ${item.similarity.toFixed(2)})</li>`;
          });
          html += '</ul>';
          resultsDiv.innerHTML = html;
      }
    });
  </script>
</body>
</html>
